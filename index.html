<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lista de Presentes — Tema Euphoria</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg1:#0f0716;--accent1:#ff6bdc;--accent2:#7afcff;--card: rgba(255,255,255,0.04)}
    *{box-sizing:border-box}
    body{margin:0;padding:40px 24px;font-family:Poppins,Arial;color:#e8e8ee;background:radial-gradient(circle at 20% 20%,#7afcff10,transparent 60%),radial-gradient(circle at 80% 80%,#ff6bdc10,transparent 60%),#0f0716}
    .container{max-width:980px;margin:0 auto}
    header{display:flex;gap:16px;align-items:center}
    .logo{width:64px;height:64px;border-radius:14px;background:linear-gradient(135deg,var(--accent1),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:800;color:#111;font-family:Playfair Display}
    h1{font-family:Playfair Display;margin:0}
    .controls{margin-left:auto}
    .btn{padding:8px 12px;border-radius:12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.08);color:#fff;cursor:pointer}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:14px;margin-top:24px}
    .card{background:var(--card);border-radius:14px;padding:14px;border:1px solid rgba(255,255,255,0.06);backdrop-filter:blur(8px);position:relative;transition:transform .2s}
    .card:hover{transform:translateY(-4px)}
    .title{font-weight:700;margin:0 0 8px}
    .meta{font-size:13px;opacity:0.9;margin-bottom:10px}
    .link-btn{display:inline-block;padding:8px 10px;border-radius:10px;background:transparent;color:#fff;text-decoration:none;border:1px solid rgba(255,255,255,0.06);font-weight:700}
    .comprado{opacity:0.5;text-decoration:line-through;pointer-events:none}
    .status{font-size:13px;margin-left:8px}
    .small{font-size:13px;opacity:0.9}
    .note{margin-top:10px;font-size:13px;color:#d4cbe0}
    img.card-img{width:100%;border-radius:10px;margin-bottom:10px;object-fit:cover;height:200px;}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">EUPH</div>
      <div>
        <h1>Minha Lista de Presentes</h1>
        <div class="small">Tema: Euphoria — neons suaves e vidro fosco</div>
      </div>
      <div class="controls">
        <button class="btn" onclick="promptAdd()">+ Adicionar</button>
        <button class="btn" onclick="clearAll()">Limpar (apagar dados compartilhados)</button>
      </div>
    </header>

    <main>
      <p class="note">Importante: esta versão usa o Firebase Realtime Database para que **qualquer pessoa que abrir o site veja as marcações de comprado em tempo real**. Veja instruções nos comentários abaixo.</p>

      <div class="grid" id="grid">
        <!-- Cada item tem data-id único -->
      </div>
    </main>
  </div>

  <!-- Firebase SDK (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

  <script>
    const FIREBASE_CONFIG = {
      // coloque sua config aqui
    };

    let db=null;
    if(FIREBASE_CONFIG && FIREBASE_CONFIG.databaseURL){
      firebase.initializeApp(FIREBASE_CONFIG);
      db = firebase.database();
    }

    const LINKS = [
      {id:'p1', title:'Modelador de Cachos Elétrico', url:'https://br.shp.ee/7YBiQ5M'},
      {id:'p2', title:'Combo Deleite (Hitratante e Body Splash)', url:'https://br.shp.ee/uCAw5xM'},
      {id:'p3', title:'Kit Deleite', url:'https://www.boticario.com.br/kit-presente-natal-cuidese-bem-deleite-4-itens/'},
      {id:'p4', title:'Body Splash Deleite', url:'https://br.shp.ee/XPA8HVP'},
      {id:'p5', title:'Kit ilía Secreto', url:'https://br.shp.ee/1Jxww2N'}
      // adicione o resto...
    ];

    // simples escape
    function escapeHtml(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}

    // Função para tentar pegar imagem do og:image
    async function fetchImage(url){
      try {
        const proxy = 'https://api.allorigins.win/get?url='; // proxy para burlar CORS
        const res = await fetch(proxy + encodeURIComponent(url));
        const data = await res.json();
        const html = new DOMParser().parseFromString(data.contents,'text/html');
        const og = html.querySelector("meta[property='og:image']");
        if(og) return og.content;
      } catch(e){
        console.log('Erro fetch imagem:', url,e);
      }
      return null;
    }

    async function renderList(state = {}) {
      const grid = document.getElementById('grid');
      grid.innerHTML = '';
      for(const item of LINKS){
        let imgSrc = item.img || await fetchImage(item.url);
        const comprado = state[item.id] && state[item.id].comprado;
        const div = document.createElement('article');
        div.className='card';
        div.innerHTML = `
          ${imgSrc ? `<img class="card-img" src="${escapeHtml(imgSrc)}" alt="${escapeHtml(item.title)}">` : ''}
          <h3 class="title">${escapeHtml(item.title)}</h3>
          <div class="meta">
            <a class="link-btn ${comprado ? 'comprado':''}" href="${escapeHtml(item.url)}" target="_blank">Abrir link</a>
            <span class="status">${comprado ? 'Comprado':'Disponível'}</span>
          </div>
          <div style="margin-top:8px">
            <button class="btn" onclick="toggleComprado('${item.id}', this)">${comprado ? 'Desmarcar como comprado' : 'Marcar como comprado'}</button>
          </div>`;
        grid.appendChild(div);
      }
    }

    function toggleComprado(itemId, btn){
      const path = '/presentes/' + itemId;
      if(db){
        const ref = db.ref(path);
        ref.once('value').then(snap=>{
          const cur = snap.val() || {};
          const novo = {comprado: !cur.comprado, ts: Date.now()};
          ref.set(novo);
        });
      }else{
        const states = JSON.parse(localStorage.getItem('presentesState')||'{}');
        states[itemId] = {comprado: !(states[itemId] && states[itemId].comprado), ts: Date.now()};
        localStorage.setItem('presentesState', JSON.stringify(states));
        renderList(states);
      }
    }

    function listenRealtime(){
      if(!db) return;
      const ref = db.ref('/presentes');
      ref.on('value', snapshot=>{
        const state = snapshot.val() || {};
        renderList(state);
      });
    }

    function clearAll(){
      if(db){
        if(!confirm('Apagar TODOS os estados compartilhados no banco?')) return;
        db.ref('/presentes').remove();
      }else{
        localStorage.removeItem('presentesState');
        renderList({});
      }
    }

    async function init(){
      if(db){
        db.ref('/presentes').once('value').then(snap=>{
          if(!snap.exists()){
            const initObj = {};
            LINKS.forEach(i=>initObj[i.id]={comprado:false,ts:0});
            db.ref('/presentes').set(initObj);
          }
          listenRealtime();
        });
      }else{
        const states = JSON.parse(localStorage.getItem('presentesState')||'{}');
        await renderList(states);
      }
    }

    init();
  </script>
</body>
</html>
